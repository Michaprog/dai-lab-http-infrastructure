<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Garage Car Search</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 50px;
        }
        .container {
            max-width: 1200px;
        }
        .table-responsive {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-center mb-4">Search Cars</h1>
    <form id="searchForm">
        <div class="row g-3">
            <!-- Marque -->
            <div class="col-md-4">
                <label for="marque" class="form-label">Marque</label>
                <input type="text" class="form-control" id="marque" placeholder="e.g., Toyota">
            </div>
            <!-- Type Carrosserie -->
            <div class="col-md-4">
                <label for="typeCarrosserie" class="form-label">Type Carrosserie</label>
                <select class="form-select" id="typeCarrosserie">
                    <option value="">Any</option>
                    <option value="Break">Break</option>
                    <option value="Cabriolet">Cabriolet</option>
                    <option value="Pick_up">Pick-up</option>
                    <option value="SUV">SUV</option>
                    <option value="Coupe">Coupe</option>
                    <option value="Berline">Berline</option>
                    <option value="Compacte">Compacte</option>
                </select>
            </div>
            <!-- Couleur -->
            <div class="col-md-4">
                <label for="couleur" class="form-label">Couleur</label>
                <select class="form-select" id="couleur">
                    <option value="">Any</option>
                    <option value="Rouge">Rouge</option>
                    <option value="Bleu">Bleu</option>
                    <option value="Vert">Vert</option>
                    <option value="Jaune">Jaune</option>
                    <option value="Noir">Noir</option>
                    <option value="Blanc">Blanc</option>
                    <option value="Gris">Gris</option>
                    <option value="Marron">Marron</option>
                    <option value="Orange">Orange</option>
                    <option value="Violet">Violet</option>
                </select>
            </div>
            <!-- Type Combustible -->
            <div class="col-md-4">
                <label for="typeCombustible" class="form-label">Type Combustible</label>
                <select class="form-select" id="typeCombustible">
                    <option value="">Any</option>
                    <option value="Essence">Essence</option>
                    <option value="Diesel">Diesel</option>
                    <option value="Électrique">Électrique</option>
                    <option value="Hybride">Hybride</option>
                    <option value="GPL">GPL</option>
                    <option value="E85">E85</option>
                    <option value="Hydrogène">Hydrogène</option>
                </select>
            </div>
            <!-- Type Boite Vitesse -->
            <div class="col-md-4">
                <label for="typeBoiteVitesse" class="form-label">Type Boite Vitesse</label>
                <select class="form-select" id="typeBoiteVitesse">
                    <option value="">Any</option>
                    <option value="Manuelle">Manuelle</option>
                    <option value="Automatique">Automatique</option>
                </select>
            </div>
            <!-- En Vente -->
            <div class="col-md-4">
                <label for="enVente" class="form-label">En Vente</label>
                <select class="form-select" id="enVente">
                    <option value="">Any</option>
                    <option value="true">Oui</option>
                    <option value="false">Non</option>
                </select>
            </div>
            <!-- Neuf -->
            <div class="col-md-4">
                <label for="neuf" class="form-label">Neuf</label>
                <select class="form-select" id="neuf">
                    <option value="">Any</option>
                    <option value="true">Oui</option>
                    <option value="false">Non</option>
                </select>
            </div>
            <!-- Prix Range -->
            <div class="col-md-6">
                <label class="form-label">Prix Range</label>
                <div class="input-group">
                    <span class="input-group-text">Min</span>
                    <input type="number" class="form-control" id="prixMin" placeholder="e.g., 10000">
                    <span class="input-group-text">Max</span>
                    <input type="number" class="form-control" id="prixMax" placeholder="e.g., 30000">
                </div>
            </div>
            <!-- Nombre Km Greater Than -->
            <div class="col-md-6">
                <label for="nombreKm" class="form-label">Nombre Km Greater Than</label>
                <input type="number" class="form-control" id="nombreKm" placeholder="e.g., 50000">
            </div>
            <!-- Submit Button -->
            <div class="col-12">
                <button type="submit" class="btn btn-primary">Search</button>
                <button type="button" class="btn btn-secondary" id="resetBtn">Reset</button>
            </div>
        </div>
    </form>

    <!-- Results Section -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered mt-4" id="resultsTable">
            <thead class="table-dark">
            <tr>
                <th>Numero Chassis</th>
                <th>Marque</th>
                <th>Type Carrosserie</th>
                <th>Couleur</th>
                <th>Date Fabrication</th>
                <th>Nombre Places</th>
                <th>Prix</th>
                <th>Nombre Portes</th>
                <th>Puissance</th>
                <th>Description Options</th>
                <th>Date Expertise</th>
                <th>Type Combustible</th>
                <th>Nombre Km</th>
                <th>Type Boite Vitesse</th>
                <th>Consommation</th>
                <th>Neuf</th>
                <th>Garantie</th>
                <th>Date Fin Garantie</th>
                <th>En Vente</th>
                <th>Propriétaire NoAVS</th>
            </tr>
            </thead>
            <tbody>
            <!-- Results will be inserted here dynamically -->
            </tbody>
        </table>
    </div>
</div>

<!-- Bootstrap JS and Dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Optional: Include jQuery for easier DOM manipulation -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#searchForm').on('submit', function(event) {
            event.preventDefault();
            performSearch();
        });

        $('#resetBtn').on('click', function() {
            $('#searchForm')[0].reset();
            $('#resultsTable tbody').empty();
        });

        function performSearch() {
            // Gather search parameters
            const marque = $('#marque').val().trim();
            const typeCarrosserie = $('#typeCarrosserie').val();
            const couleur = $('#couleur').val();
            const typeCombustible = $('#typeCombustible').val();
            const typeBoiteVitesse = $('#typeBoiteVitesse').val();
            const enVente = $('#enVente').val();
            const neuf = $('#neuf').val();
            const prixMin = $('#prixMin').val();
            const prixMax = $('#prixMax').val();
            const nombreKm = $('#nombreKm').val();

            let queryParams = [];

            if (marque) {
                queryParams.push(`marque=${encodeURIComponent(marque)}`);
            }
            if (typeCarrosserie) {
                queryParams.push(`typeCarrosserie=${encodeURIComponent(typeCarrosserie)}`);
            }
            if (couleur) {
                queryParams.push(`couleur=${encodeURIComponent(couleur)}`);
            }
            if (typeCombustible) {
                queryParams.push(`typeCombustible=${encodeURIComponent(typeCombustible)}`);
            }
            if (typeBoiteVitesse) {
                queryParams.push(`typeBoiteVitesse=${encodeURIComponent(typeBoiteVitesse)}`);
            }
            if (enVente) {
                queryParams.push(`enVente=${encodeURIComponent(enVente)}`);
            }
            if (neuf) {
                queryParams.push(`neuf=${encodeURIComponent(neuf)}`);
            }
            if (prixMin) {
                queryParams.push(`prixMin=${encodeURIComponent(prixMin)}`);
            }
            if (prixMax) {
                queryParams.push(`prixMax=${encodeURIComponent(prixMax)}`);
            }
            if (nombreKm) {
                queryParams.push(`nombreKm=${encodeURIComponent(nombreKm)}`);
            }

            // Construct the API endpoint based on available parameters
            let apiUrl = '/api/voitures';

            // Example: If marque is specified, use /api/voitures/marque/{marque}
            // Similarly, handle other parameters or combinations as needed
            // For simplicity, we'll fetch all and filter on the client side

            $.ajax({
                url: apiUrl,
                method: 'GET',
                success: function(data) {
                    let filteredData = data;

                    if (marque) {
                        filteredData = filteredData.filter(v => v.marque.toLowerCase().includes(marque.toLowerCase()));
                    }
                    if (typeCarrosserie) {
                        filteredData = filteredData.filter(v => v.typeCarrosserie === typeCarrosserie);
                    }
                    if (couleur) {
                        filteredData = filteredData.filter(v => v.couleur === couleur);
                    }
                    if (typeCombustible) {
                        filteredData = filteredData.filter(v => v.typeCombustible === typeCombustible);
                    }
                    if (typeBoiteVitesse) {
                        filteredData = filteredData.filter(v => v.typeBoiteVitesse === typeBoiteVitesse);
                    }
                    if (enVente) {
                        const enVenteBool = enVente === 'true';
                        filteredData = filteredData.filter(v => v.enVente === enVenteBool);
                    }
                    if (neuf) {
                        const neufBool = neuf === 'true';
                        filteredData = filteredData.filter(v => v.neuf === neufBool);
                    }
                    if (prixMin) {
                        filteredData = filteredData.filter(v => v.prix && v.prix >= parseFloat(prixMin));
                    }
                    if (prixMax) {
                        filteredData = filteredData.filter(v => v.prix && v.prix <= parseFloat(prixMax));
                    }
                    if (nombreKm) {
                        filteredData = filteredData.filter(v => v.nombreKm >= parseInt(nombreKm));
                    }

                    displayResults(filteredData);
                },
                error: function(xhr, status, error) {
                    alert('An error occurred while fetching data.');
                    console.error(error);
                }
            });
        }

        function displayResults(voitures) {
            const tbody = $('#resultsTable tbody');
            tbody.empty();

            if (voitures.length === 0) {
                tbody.append('<tr><td colspan="19" class="text-center">No results found.</td></tr>');
                return;
            }

            voitures.forEach(voiture => {
                const row = `
                        <tr>
                            <td>${voiture.numeroChassis}</td>
                            <td>${voiture.marque}</td>
                            <td>${voiture.typeCarrosserie}</td>
                            <td>${voiture.couleur}</td>
                            <td>${voiture.dateFabrication}</td>
                            <td>${voiture.nombrePlaces}</td>
                            <td>${voiture.prix ? voiture.prix.toFixed(2) : 'N/A'}</td>
                            <td>${voiture.nombrePortes}</td>
                            <td>${voiture.puissance}</td>
                            <td>${voiture.descriptionOptions || 'N/A'}</td>
                            <td>${voiture.dateExpertise}</td>
                            <td>${voiture.typeCombustible}</td>
                            <td>${voiture.nombreKm}</td>
                            <td>${voiture.typeBoiteVitesse}</td>
                            <td>${voiture.consommation ? voiture.consommation.toFixed(2) : 'N/A'}</td>
                            <td>${voiture.neuf ? 'Oui' : 'Non'}</td>
                            <td>${voiture.garantie ? 'Oui' : 'Non'}</td>
                            <td>${voiture.dateFinGarantie || 'N/A'}</td>
                            <td>${voiture.enVente ? 'Oui' : 'Non'}</td>
                            <td>${voiture.proprietaire ? voiture.proprietaire.noAVS : 'N/A'}</td>
                        </tr>
                    `;
                tbody.append(row);
            });
        }
    });
</script>
</body>
</html>
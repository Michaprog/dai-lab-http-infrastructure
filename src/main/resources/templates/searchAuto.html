<!-- src/main/resources/templates/searchAuto.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Cars</title>
    <!-- Bootstrap CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 50px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
        }
        .table-responsive {
            margin-top: 20px;
        }
        .card {
            margin-bottom: 20px;
        }
        .form-label {
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-center mb-4">Search Cars</h1>

    <!-- Search by Marque -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Search by Marque</h5>
            <form id="searchByMarqueForm">
                <div class="mb-3">
                    <label for="marque" class="form-label">Marque</label>
                    <input type="text" class="form-control" id="marque" placeholder="e.g., Toyota" required>
                </div>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>
    </div>

    <!-- Search by Couleur -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Search by Couleur</h5>
            <form id="searchByCouleurForm">
                <div class="mb-3">
                    <label for="couleur" class="form-label">Couleur</label>
                    <select class="form-select" id="couleur" required>
                        <option value="" disabled selected>Select Couleur</option>
                        <option>BLEU</option>
                        <option>ROUGE</option>
                        <option>NOIR</option>
                        <option>BLANC</option>
                        <option>GRIS</option>
                        <option>VERT</option>
                        <option>JAUNE</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>
    </div>

    <!-- Search by Type Carrosserie -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Search by Type Carrosserie</h5>
            <form id="searchByTypeCarrosserieForm">
                <div class="mb-3">
                    <label for="typeCarrosserie" class="form-label">Type Carrosserie</label>
                    <select class="form-select" id="typeCarrosserie" required>
                        <option value="" disabled selected>Select Type Carrosserie</option>
                        <option>SUV</option>
                        <option>CABRIOLET</option>
                        <option>BREAK</option>
                        <option>BERLINE</option>
                        <option>COMPACTE</option>
                        <option>PICK_UP</option>
                        <option>COUPE</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>
    </div>

    <!-- Add more search forms as needed -->

    <!-- Results Section -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered mt-4" id="resultsTable">
            <thead class="table-dark">
            <tr>
                <th>Numero Chassis</th>
                <th>Marque</th>
                <th>Type Carrosserie</th>
                <th>Couleur</th>
                <th>Date Fabrication</th>
                <th>Nombre Places</th>
                <th>Prix (€)</th>
                <th>Nombre Portes</th>
                <th>Puissance (ch)</th>
                <th>Description Options</th>
                <th>Date Expertise</th>
                <th>Type Combustible</th>
                <th>Nombre Km</th>
                <th>Type Boite Vitesse</th>
                <th>Consommation (l/100km)</th>
                <th>Neuf</th>
                <th>Garantie</th>
                <th>Date Fin Garantie</th>
                <th>En Vente</th>
                <th>Propriétaire NoAVS</th>
            </tr>
            </thead>
            <tbody>
            <!-- Results will be inserted here dynamically -->
            </tbody>
        </table>
    </div>
</div>

<!-- Bootstrap JS and Dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Include jQuery for easier DOM manipulation (optional) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle Search by Marque
        document.getElementById('searchByMarqueForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const marque = document.getElementById('marque').value.trim();
            if (marque) {
                fetch(`/api/voitures/marque/${encodeURIComponent(marque)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => displayResults(data))
                    .catch(error => handleError(error));
            }
        });

        // Handle Search by Couleur
        document.getElementById('searchByCouleurForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const couleur = document.getElementById('couleur').value;
            if (couleur) {
                fetch(`/api/voitures/couleur/${encodeURIComponent(couleur)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => displayResults(data))
                    .catch(error => handleError(error));
            }
        });

        // Handle Search by Type Carrosserie
        document.getElementById('searchByTypeCarrosserieForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const typeCarrosserie = document.getElementById('typeCarrosserie').value;
            if (typeCarrosserie) {
                fetch(`/api/voitures/typeCarrosserie/${encodeURIComponent(typeCarrosserie)}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => displayResults(data))
                    .catch(error => handleError(error));
            }
        });

        // Add more event listeners for additional search forms as needed

        // Function to display results in the table
        function displayResults(voitures) {
            const tbody = document.getElementById('resultsTable').getElementsByTagName('tbody')[0];
            tbody.innerHTML = ''; // Clear previous results

            if (voitures.length === 0) {
                const row = tbody.insertRow();
                const cell = row.insertCell(0);
                cell.colSpan = 19;
                cell.className = 'text-center';
                cell.textContent = 'No results found.';
                return;
            }

            voitures.forEach(voiture => {
                const row = tbody.insertRow();
                row.innerHTML = `
                        <td>${voiture.numeroChassis}</td>
                        <td>${voiture.marque}</td>
                        <td>${voiture.typeCarrosserie}</td>
                        <td>${voiture.couleur}</td>
                        <td>${voiture.dateFabrication}</td>
                        <td>${voiture.nombrePlaces}</td>
                        <td>${voiture.prix ? voiture.prix.toFixed(2) : 'N/A'}</td>
                        <td>${voiture.nombrePortes}</td>
                        <td>${voiture.puissance}</td>
                        <td>${voiture.descriptionOptions || 'N/A'}</td>
                        <td>${voiture.dateExpertise || 'N/A'}</td>
                        <td>${voiture.typeCombustible}</td>
                        <td>${voiture.nombreKm}</td>
                        <td>${voiture.typeBoiteVitesse}</td>
                        <td>${voiture.consommation ? voiture.consommation.toFixed(2) : 'N/A'}</td>
                        <td>${voiture.neuf ? 'Oui' : 'Non'}</td>
                        <td>${voiture.garantie ? 'Oui' : 'Non'}</td>
                        <td>${voiture.dateFinGarantie || 'N/A'}</td>
                        <td>${voiture.enVente ? 'Oui' : 'Non'}</td>
                        <td>${voiture.proprietaire ? voiture.proprietaire.noAVS : 'N/A'}</td>
                    `;
            });
        }

        // Function to handle errors
        function handleError(error) {
            console.error('Error:', error);
            alert('An error occurred while fetching data. Please try again.');
        }
    });
</script>
</body>
</html>